<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вибір пісень - Perfect Band</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-gold': '#d4af37',
                        'brand-brown': '#5d4037',
                        'brand-dark': '#4a3b2a',
                    },
                    fontFamily: { sans: ['Montserrat', 'sans-serif'] }
                }
            }
        }
    </script>

    <style>
        body { background-color: #fcfaf8; color: #4a3b2a; }

        .search-input {
            border-radius: 4px;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }
        .search-input:focus {
            border-color: #d4af37;
            outline: none;
        }

        .song-card {
            transition: transform 0.1s ease-out;
            border-style: solid;
            border-width: 1px 1px 1px 5px;
            border-color: transparent;
            border-radius: 0 4px 4px 0;
        }
        .song-card:active { transform: scale(0.98); background-color: #f9fafb; }
        .song-card.selected {
            background-color: #fdf6e7;
            border-color: #f0e6d2 #f0e6d2 #f0e6d2 #d4af37;
        }

        .selected-item-row {
            display: flex;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
            transition: all 0.1s ease-in-out;
        }

        .selected-item-row:has(.delete-btn:active) {
            transform: scale(0.99);
            background-color: #fee2e2;
            border-color: #fecaca;
        }
        .selected-item-row:has(.delete-btn:active) .flex-1,
        .selected-item-row:has(.delete-btn:active) .delete-btn {
            background-color: #fee2e2;
            border-left-color: transparent;
        }

        .delete-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 3.5rem;
            background-color: #fee2e2;
            color: #ef4444;
            cursor: pointer;
            border-left: 1px solid #fecaca;
            transition: border-color 0.1s;
        }

        .scroll-button {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background-color: #d4af37;
            color: white;
            width: 100px;
            height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            z-index: 50;
            border: 3px solid white;
            border-radius: 8px;
        }
        .scroll-button:active { transform: scale(0.95); }

        button:active { transform: scale(0.96); }
        .btn-success { background: #16a34a !important; border-color: #16a34a !important; color: white !important; }

        #copyButtonTop {
            width: 210px !important;
            min-width: 210px !important;
            max-width: 210px !important;
        }

        .section-divider {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 2rem 0;
            color: #d4af37;
            opacity: 0.6;
        }
        .section-divider::before, .section-divider::after {
            content: ""; flex: 1; border-bottom: 1px solid #d4af37; margin: 0 1rem;
        }
    </style>
</head>
<body class="antialiased min-h-screen pb-20">

    <div class="w-full bg-[#1a1a1a] py-8 px-6 shadow-md flex justify-center">
        <img src="logo.png" alt="Perfect Band" class="h-52 object-contain">
    </div>

    <div class="container mx-auto max-w-[900px] px-4">

        <div class="flex flex-col items-center pt-6 pb-6">
            <h1 class="text-3xl font-bold text-brand-dark text-center">Ваш ідеальний плейлист</h1>
            <p class="text-center text-brand-brown/80 mt-2">Оберіть до 50 пісень</p>
        </div>

        <div class="relative mb-10">
            <div class="relative shadow-md">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <i class="fa-solid fa-search text-brand-gold text-lg"></i>
                </div>
                <input type="text" id="searchInput"
                    placeholder="Пошук пісні або виконавця..."
                    class="search-input w-full py-4 pl-12 pr-6 bg-white text-brand-dark">
            </div>
        </div>

        <div class="flex flex-col gap-8">
            <div id="songList" class="flex flex-col space-y-2"></div>

            <div id="selectedSongsSection" class="mt-16">
                <div class="section-divider"><i class="fa-solid fa-compact-disc text-xl"></i></div>

                <div class="bg-white shadow-xl border border-stone-100 overflow-hidden rounded-lg">
                    <div class="bg-brand-dark text-white p-4 sm:p-6 flex flex-col items-center sm:flex-row gap-4 sm:justify-between relative">
                            <div class="z-10 text-center sm:text-left">
                                <h2 class="text-xl font-bold">Ваш вибір</h2>
                                <p class="text-white/70 text-xs mt-1">Список для музикантів</p>
                            </div>

                            <div class="flex flex-wrap items-center justify-center sm:justify-end gap-2 z-10">

                                <button id="copyButtonTop" class="h-10 rounded bg-white/10 border border-white/20 flex items-center justify-center gap-2 text-xs font-bold uppercase tracking-wider transition-all whitespace-nowrap">
                                    <i class="fa-regular fa-copy"></i>
                                    <span>Скопіювати список</span>
                                </button>

                                <button id="undoButton" class="w-10 h-10 rounded bg-white/10 flex items-center justify-center disabled:opacity-30 border border-white/20 transition-all" disabled title="Відновити видалене">
                                    <i class="fa-solid fa-arrow-rotate-left text-white"></i>
                                </button>

                                <div id="selectedCounterTop" class="h-10 flex items-center justify-center bg-black/20 px-4 rounded font-bold tracking-tight">
                                    <div class="flex items-baseline">
                                        <span id="counterValueTop" class="text-2xl text-brand-gold transition-colors leading-none">0</span>
                                        <span class="text-base text-white/40 ml-0.5 leading-none">/50</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="p-4 sm:p-8 bg-stone-50 min-h-[150px]">
                        <div id="selectedListContainer">
                            <div id="emptySelectedMessage" class="flex flex-col items-center justify-center py-10 text-brand-brown/40">
                                <p class="text-lg">Список порожній</p>
                            </div>
                        </div>
                    </div>

                    <div class="p-6 border-t border-stone-100 bg-white">
                        <button id="copyButton" class="w-full py-4 bg-brand-dark text-white font-bold rounded shadow-lg flex items-center justify-center gap-2 transition-all">
                            <i class="fa-regular fa-copy"></i>
                            <span>Скопіювати список</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <button id="scrollButton" class="scroll-button">
            <div class="flex items-baseline leading-none">
                <span id="selectedCounterBottom" class="text-2xl font-bold transition-colors">0</span>
                <span class="text-base opacity-70 ml-0.5">/50</span>
            </div>
            <i class="fa-solid fa-chevron-down text-3xl leading-none -mt-1.5"></i>
        </button>
    </div>

<script src="songs-data.js"></script>
<script>
    const MAX_SONGS = 50;
    const scrollButton = document.getElementById('scrollButton');
    const searchInput = document.getElementById('searchInput');
    const songList = document.getElementById('songList');
    const selectedListContainer = document.getElementById('selectedListContainer');
    const counterValueTop = document.getElementById('counterValueTop');
    const selectedCounterBottom = document.getElementById('selectedCounterBottom');
    const copyButton = document.getElementById('copyButton');
    const copyButtonTop = document.getElementById('copyButtonTop');
    const undoButton = document.getElementById('undoButton');

    let selectedSongs = JSON.parse(localStorage.getItem('selectedSongs')) || [];
    let deleteHistory = [];

    scrollButton.addEventListener('click', () => {
        document.getElementById('selectedSongsSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
    });

    function renderSongList(filter = '') {
        const filteredSongs = allSongs.filter(s =>
            s.title.toLowerCase().includes(filter.toLowerCase()) ||
            s.artist.toLowerCase().includes(filter.toLowerCase())
        );

        const grouped = filteredSongs.reduce((acc, s) => {
            if (!acc[s.category]) acc[s.category] = {};
            if (!acc[s.category][s.subcategory]) acc[s.category][s.subcategory] = [];
            acc[s.category][s.subcategory].push(s);
            return acc;
        }, {});

        let html = '';

        Object.keys(grouped).forEach(cat => {
            html += `<div class="mt-8 mb-4 flex items-center gap-4"><h2 class="text-2xl font-bold text-brand-dark">${cat}</h2><div class="h-px bg-brand-gold/20 flex-grow"></div></div>`;

            Object.keys(grouped[cat]).forEach(sub => {
                html += `<h3 class="text-lg font-semibold mt-4 mb-2 text-brand-brown/70">${sub}</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-24">`;

                grouped[cat][sub].forEach(song => {
                    const isSelected = selectedSongs.some(s => s.id === song.id);
                    html += `<div class="song-card cursor-pointer bg-white p-4 shadow-sm flex items-center justify-between ${isSelected ? 'selected' : ''}" data-song-id="${song.id}">
                        <div class="flex-1 pr-4 font-medium">${song.title}<span class="text-xs text-gray-500 block">${song.artist}</span></div>
                    </div>`;
                });
                html += `</div>`;
            });
        });

        if (filteredSongs.length === 0 && filter !== '') {
            html = `<div class="text-center py-10 text-brand-brown/50 italic">Нічого не знайдено за запитом "${filter}"</div>`;
        }

        songList.innerHTML = html;
    }

    function renderSelectedList() {
        if (selectedSongs.length === 0) {
            selectedListContainer.innerHTML = '<div class="text-center py-10 opacity-30">Список порожній</div>';
            return;
        }
        selectedListContainer.innerHTML = '';
        let counter = 1;
        selectedSongs.forEach(song => {
            selectedListContainer.innerHTML += `
                <div class="selected-item-row">
                    <div class="flex-1 p-3 flex items-center transition-colors"><span class="font-mono text-brand-gold font-bold mr-3 w-6 text-right">${counter}.</span><div><span class="font-medium block leading-tight">${song.title}</span><span class="text-xs text-gray-500">${song.artist}</span></div></div>
                    <div class="delete-btn" data-song-id="${song.id}"><i class="fa-solid fa-trash-can text-lg"></i></div>
                </div>`;
            counter++;
        });
    }

    function updateCounters() {
        const count = selectedSongs.length;
        counterValueTop.textContent = count;
        selectedCounterBottom.textContent = count;
        undoButton.disabled = deleteHistory.length === 0;

        if (count > MAX_SONGS) {
            counterValueTop.classList.replace('text-brand-gold', 'text-red-500');
            selectedCounterBottom.style.color = '#ef4444';
        } else {
            counterValueTop.classList.add('text-brand-gold');
            counterValueTop.classList.remove('text-red-500');
            selectedCounterBottom.style.color = 'white';
        }
    }

    function handleSongSelection(id, select) {
        if (select) {
            if (!selectedSongs.some(s => s.id === id)) selectedSongs.push(allSongs.find(s => s.id === id));
        } else {
            deleteHistory.push(id);
            selectedSongs = selectedSongs.filter(s => s.id !== id);
        }
        localStorage.setItem('selectedSongs', JSON.stringify(selectedSongs));
        renderSongList(searchInput.value);
        renderSelectedList();
        updateCounters();
    }

    function copyList() {
        let text = `Плейлист (${selectedSongs.length}/${MAX_SONGS}):\n\n`;
        selectedSongs.forEach((s, i) => text += `${i+1}. ${s.title} - ${s.artist}\n`);

        navigator.clipboard.writeText(text).then(() => {
            [copyButton, copyButtonTop].forEach(btn => {
                const originalHtml = btn.innerHTML;
                btn.classList.add('btn-success');
                btn.querySelector('span').innerText = 'СКОПІЙОВАНО';
                setTimeout(() => {
                    btn.classList.remove('btn-success');
                    btn.innerHTML = originalHtml;
                }, 3000);
            });
        });
    }

    searchInput.addEventListener('input', e => renderSongList(e.target.value));
    songList.addEventListener('click', e => {
        const card = e.target.closest('.song-card');
        if (card) handleSongSelection(card.dataset.songId, !selectedSongs.some(s => s.id === card.dataset.songId));
    });
    selectedListContainer.addEventListener('click', e => {
        const btn = e.target.closest('.delete-btn');
        if (btn) handleSongSelection(btn.dataset.songId, false);
    });
    undoButton.addEventListener('click', () => {
        if (deleteHistory.length) {
            const id = deleteHistory.pop();
            const song = allSongs.find(s => s.id === id);
            if (song && !selectedSongs.some(s => s.id === id)) selectedSongs.push(song);
            localStorage.setItem('selectedSongs', JSON.stringify(selectedSongs));
            renderSongList(searchInput.value); renderSelectedList(); updateCounters();
        }
    });
    copyButton.addEventListener('click', copyList);
    copyButtonTop.addEventListener('click', copyList);

    renderSongList(); renderSelectedList(); updateCounters();
</script>
</body>
</html>
